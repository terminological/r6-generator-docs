---
title: "R6 Generator Maven Archetype: Recommended project setup"
author: "Rob Challen"
output: html_vignette
vignette: >
  %\VignetteIndexEntry{R6 Generator Maven Archetype: Recommended project setup}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(
  echo = TRUE,
  error = TRUE)


if (.Platform$OS.type == "windows") {
  
  # don't try evaluate this vignette
  # in windows as bash chunks don't always work
  knitr::opts_chunk$set(eval = FALSE)

} else {
  
  # stop this from being run if not being run as part of build_site()
  # this should stop it from running on CRAN and in github worflows
  inPkgdown = identical(Sys.getenv("IN_PKGDOWN"), "true")
  knitr::opts_chunk$set(eval = inPkgdown)
  
}
```

The project configuration needed for a Java project with generated R package
can be automated to allow easy best practice using a maven archetype.

# STEP 1: Set up temporary location:

For the purposes of this vignette we are using a temporary directory and the 
most up to date version of the generator library available which we are setting
as the $TMP_VERSION environment variable. 

```{r echo=FALSE}
dir = fs::path(tempdir(),"testProject")
fs::dir_create(dir)
Sys.setenv(TMP_DIR=dir)
dir

v = testRapi::JavaApi$versionInformation()
version = stringr::str_replace(v$java_library_version, "io.github.terminological:r6-generator-docs:", "")
Sys.setenv(TMP_VERSION=version)
version
```

## Maven archetype

The maven archetype is triggered from the command line and will interactively 
ask for the details if not provided inline as in this example:

```{bash}
cd $TMP_DIR
rm -r examplePackage ||: 
mvn archetype:generate -B \
  -DarchetypeGroupId=io.github.terminological \
  -DarchetypeArtifactId=r6-generator-maven-archetype \
  -DarchetypeVersion=$TMP_VERSION \
  -DgithubOrganisation=exampleOrganisation \
  -DgithubRepository=examplePackage
```

with this configuration it creates a skeleton example project consisting mostly of
Java and maven files set up as follows.

```{r echo=FALSE}
fs::dir_tree(dir,regexp="((.*/target)|docs)/.*", invert=TRUE)
```

## Building the project

The project should be fully ready to be built as a R package, with the minimal
example class provided.

```{bash}
cd $TMP_DIR/examplePackage/java
mvn install
```

# Generated files:

Building the project creates a set of generated R package files, which provide 
all the R package infrastructure, to execute the Java code from R. These 
additional files are all generated from the Java code by the maven plugin.

```{r echo=FALSE}
fs::dir_tree(dir,regexp="((.*/target)|docs)/.*", invert=TRUE)
```

# Package website:

The maven package installation in this example is configured to build a 
`pkgdown` site which can be viewed as follows:

```{r}
if (interactive()) 
  browseURL(paste0("file:/",URLencode(fs::path(dir,"examplePackage","docs","index.html"))))
```