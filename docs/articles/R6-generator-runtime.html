<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>R6 Generator Runtime: Using R Datatypes in Java â€¢ testRapi</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="R6 Generator Runtime: Using R Datatypes in Java">
<meta property="og:description" content="testRapi">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">testRapi</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/testRapi.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/R6-generator-datatypes.html">R6 Generator Maven Plugin: Datatype conversion</a>
    </li>
    <li>
      <a href="../articles/R6-generator-features.html">R6 Generator Maven Plugin: Key features</a>
    </li>
    <li>
      <a href="../articles/web-only/R6-generator-maven-archetype.html">R6 Generator Maven Archetype: Recommended project setup</a>
    </li>
    <li>
      <a href="../articles/R6-generator-maven-config.html">R6 Generator Maven Plugin: Metadata and Maven configuration</a>
    </li>
    <li>
      <a href="../articles/R6-generator-runtime.html">R6 Generator Runtime: Using R Datatypes in Java</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/terminological/r6-generator-docs/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>R6 Generator Runtime: Using R Datatypes in
Java</h1>
                        <h4 data-toc-skip class="author">Rob
Challen</h4>
            
            <h4 data-toc-skip class="date">28/10/2020</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/terminological/r6-generator-docs/blob/HEAD/vignettes/R6-generator-runtime.Rmd" class="external-link"><code>vignettes/R6-generator-runtime.Rmd</code></a></small>
      <div class="hidden name"><code>R6-generator-runtime.Rmd</code></div>

    </div>

    
    
<p>There are a number of utility classes in the runtime java library to
facilitate data marshalling between Java and R. This is an incomplete
overview of some of the patterns you can use to convert Java data to an
R friendly form.</p>
<div class="section level2">
<h2 id="imports">Imports<a class="anchor" aria-label="anchor" href="#imports"></a>
</h2>
<p>The main imports that are useful in Java code that provides an R api
are:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="kw">import</span> <span class="im">uk</span><span class="op">.</span><span class="im">co</span><span class="op">.</span><span class="im">terminological</span><span class="op">.</span><span class="im">rjava</span><span class="op">.</span><span class="im">types</span><span class="op">.*;</span></span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="kw">import</span> <span class="kw">static</span><span class="im"> uk</span><span class="op">.</span><span class="im">co</span><span class="op">.</span><span class="im">terminological</span><span class="op">.</span><span class="im">rjava</span><span class="op">.</span><span class="im">RConverter</span><span class="op">.*;</span></span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a><span class="kw">import</span> <span class="kw">static</span><span class="im"> uk</span><span class="op">.</span><span class="im">co</span><span class="op">.</span><span class="im">terminological</span><span class="op">.</span><span class="im">rjava</span><span class="op">.</span><span class="im">Rule</span><span class="op">.</span><span class="im">MapRule</span><span class="op">.*;</span></span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a><span class="kw">import</span> <span class="im">uk</span><span class="op">.</span><span class="im">co</span><span class="op">.</span><span class="im">terminological</span><span class="op">.</span><span class="im">rjava</span><span class="op">.</span><span class="im">IncompatibleTypeException</span><span class="op">;</span></span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a><span class="kw">import</span> <span class="im">uk</span><span class="op">.</span><span class="im">co</span><span class="op">.</span><span class="im">terminological</span><span class="op">.</span><span class="im">rjava</span><span class="op">.</span><span class="im">NameNotFoundException</span><span class="op">;</span></span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a><span class="kw">import</span> <span class="im">uk</span><span class="op">.</span><span class="im">co</span><span class="op">.</span><span class="im">terminological</span><span class="op">.</span><span class="im">rjava</span><span class="op">.</span><span class="im">RConverter</span><span class="op">;</span></span>
<span id="cb1-8"><a href="#cb1-8" tabindex="-1"></a><span class="kw">import</span> <span class="im">uk</span><span class="op">.</span><span class="im">co</span><span class="op">.</span><span class="im">terminological</span><span class="op">.</span><span class="im">rjava</span><span class="op">.</span><span class="im">utils</span><span class="op">.</span><span class="im">RFunctions</span><span class="op">;</span></span>
<span id="cb1-9"><a href="#cb1-9" tabindex="-1"></a><span class="kw">import</span> <span class="im">uk</span><span class="op">.</span><span class="im">co</span><span class="op">.</span><span class="im">terminological</span><span class="op">.</span><span class="im">rjava</span><span class="op">.</span><span class="im">RName</span><span class="op">;</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="wrapping-and-unwrapping">Wrapping and unwrapping<a class="anchor" aria-label="anchor" href="#wrapping-and-unwrapping"></a>
</h2>
<p>Unwrapping data that arrives from R is usually the case of calling
<code>.get()</code> on the <code>RObject</code> class, which should give
you the standard Java object. For primitives this will be in their boxed
form with NA values represented as null. A <code>.opt()</code> call will
attempt to coerce the input to a specific Java class and give you the
result as a <code>Optional</code> if it can do so. In this case empty
optionals may be NA or incompatible values in R.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a>        RDate date <span class="op">=</span> RDate<span class="op">.</span><span class="fu">from</span><span class="op">(</span><span class="st">"2020-02-02"</span><span class="op">);</span></span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a>        <span class="fu">assertTrue</span><span class="op">(</span>date<span class="op">.</span><span class="fu">opt</span><span class="op">(</span>LocalDate<span class="op">.</span><span class="fu">class</span><span class="op">).</span><span class="fu">isPresent</span><span class="op">());</span></span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a>        <span class="fu">assertTrue</span><span class="op">(</span>date<span class="op">.</span><span class="fu">get</span><span class="op">().</span><span class="fu">toString</span><span class="op">().</span><span class="fu">equals</span><span class="op">(</span><span class="st">"2020-02-02"</span><span class="op">));</span></span>
<span id="cb2-4"><a href="#cb2-4" tabindex="-1"></a>        </span>
<span id="cb2-5"><a href="#cb2-5" tabindex="-1"></a>        <span class="co">// RPrimitive.as(Class&lt;?&gt;) returns an optional. NA or incorrect types both come out as Optional.empty()</span></span>
<span id="cb2-6"><a href="#cb2-6" tabindex="-1"></a>        RNumeric num <span class="op">=</span> RNumeric<span class="op">.</span><span class="fu">from</span><span class="op">(</span><span class="fl">123.456</span><span class="op">);</span></span>
<span id="cb2-7"><a href="#cb2-7" tabindex="-1"></a>        <span class="fu">assertTrue</span><span class="op">(</span>num<span class="op">.</span><span class="fu">opt</span><span class="op">(</span><span class="bu">BigDecimal</span><span class="op">.</span><span class="fu">class</span><span class="op">).</span><span class="fu">isPresent</span><span class="op">());</span></span>
<span id="cb2-8"><a href="#cb2-8" tabindex="-1"></a>        <span class="fu">assertTrue</span><span class="op">(</span>num<span class="op">.</span><span class="fu">opt</span><span class="op">(</span><span class="bu">Float</span><span class="op">.</span><span class="fu">class</span><span class="op">).</span><span class="fu">isPresent</span><span class="op">());</span></span>
<span id="cb2-9"><a href="#cb2-9" tabindex="-1"></a>        <span class="fu">assertTrue</span><span class="op">(</span>num<span class="op">.</span><span class="fu">opt</span><span class="op">(</span><span class="bu">Long</span><span class="op">.</span><span class="fu">class</span><span class="op">).</span><span class="fu">isPresent</span><span class="op">());</span></span>
<span id="cb2-10"><a href="#cb2-10" tabindex="-1"></a>        </span>
<span id="cb2-11"><a href="#cb2-11" tabindex="-1"></a>        <span class="co">// Will return an Optional.empty() as not a String</span></span>
<span id="cb2-12"><a href="#cb2-12" tabindex="-1"></a>        <span class="fu">assertTrue</span><span class="op">(!</span>num<span class="op">.</span><span class="fu">opt</span><span class="op">(</span><span class="bu">String</span><span class="op">.</span><span class="fu">class</span><span class="op">).</span><span class="fu">isPresent</span><span class="op">());</span></span>
<span id="cb2-13"><a href="#cb2-13" tabindex="-1"></a>        </span>
<span id="cb2-14"><a href="#cb2-14" tabindex="-1"></a>        <span class="co">// RPrimitive.get() will return the main underlying implementation type (in this case a Double) or a null for a NA</span></span>
<span id="cb2-15"><a href="#cb2-15" tabindex="-1"></a>        <span class="fu">assertTrue</span><span class="op">(</span>num<span class="op">.</span><span class="fu">get</span><span class="op">().</span><span class="fu">doubleValue</span><span class="op">()</span> <span class="op">==</span> <span class="fl">123.456</span><span class="op">);</span></span>
<span id="cb2-16"><a href="#cb2-16" tabindex="-1"></a>        <span class="fu">assertTrue</span><span class="op">(</span>num<span class="op">.</span><span class="fu">get</span><span class="op">(</span><span class="bu">Float</span><span class="op">.</span><span class="fu">class</span><span class="op">).</span><span class="fu">equals</span><span class="op">(</span><span class="fl">123.456F</span><span class="op">));</span></span>
<span id="cb2-17"><a href="#cb2-17" tabindex="-1"></a>        </span>
<span id="cb2-18"><a href="#cb2-18" tabindex="-1"></a>        <span class="co">// NA values are returned as Optional.empty() by RPrimitive.opt()</span></span>
<span id="cb2-19"><a href="#cb2-19" tabindex="-1"></a>        <span class="fu">assertTrue</span><span class="op">(!</span>RInteger<span class="op">.</span><span class="fu">NA</span><span class="op">.</span><span class="fu">opt</span><span class="op">().</span><span class="fu">isPresent</span><span class="op">());</span></span>
<span id="cb2-20"><a href="#cb2-20" tabindex="-1"></a>        <span class="fu">assertTrue</span><span class="op">(</span>RInteger<span class="op">.</span><span class="fu">from</span><span class="op">(</span><span class="dv">234</span><span class="op">).</span><span class="fu">opt</span><span class="op">().</span><span class="fu">isPresent</span><span class="op">());</span></span>
<span id="cb2-21"><a href="#cb2-21" tabindex="-1"></a>        </span></code></pre></div>
</div>
<div class="section level2">
<h2 id="rvector-creation-and-transformation">RVector creation and transformation<a class="anchor" aria-label="anchor" href="#rvector-creation-and-transformation"></a>
</h2>
<p>RVectors can be created from Java collections, arrays or Streams,
using either static methods on the <code>RVector</code> class or using
the <code>RConverter</code> static collector methods or
<code>convert()</code> method.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a>        </span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a>        <span class="co">// Java boxed arrays can be directly converted to vector from RVector</span></span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a>        <span class="co">// Integer.MIN_VALUE inputs are converted to nulls silently</span></span>
<span id="cb3-4"><a href="#cb3-4" tabindex="-1"></a>        <span class="bu">Integer</span><span class="op">[]</span> tmp <span class="op">=</span> <span class="op">{</span><span class="dv">1</span><span class="op">,</span><span class="dv">3</span><span class="op">,</span><span class="dv">5</span><span class="op">,</span><span class="dv">7</span><span class="op">,</span> <span class="kw">null</span><span class="op">,</span> <span class="bu">Integer</span><span class="op">.</span><span class="fu">MIN_VALUE</span><span class="op">,</span> <span class="bu">Integer</span><span class="op">.</span><span class="fu">MIN_VALUE</span><span class="op">+</span><span class="dv">1</span><span class="op">,</span> <span class="dv">0</span><span class="op">};</span></span>
<span id="cb3-5"><a href="#cb3-5" tabindex="-1"></a>        RIntegerVector col0 <span class="op">=</span> RVector<span class="op">.</span><span class="fu">with</span><span class="op">(</span>tmp<span class="op">);</span></span>
<span id="cb3-6"><a href="#cb3-6" tabindex="-1"></a>        RIntegerVector col1 <span class="op">=</span> <span class="fu">convert</span><span class="op">(</span>tmp<span class="op">);</span></span>
<span id="cb3-7"><a href="#cb3-7" tabindex="-1"></a>        </span>
<span id="cb3-8"><a href="#cb3-8" tabindex="-1"></a>        <span class="fu">assertTrue</span><span class="op">(</span>col1<span class="op">.</span><span class="fu">get</span><span class="op">(</span><span class="dv">4</span><span class="op">).</span><span class="fu">isNa</span><span class="op">());</span></span>
<span id="cb3-9"><a href="#cb3-9" tabindex="-1"></a>        <span class="fu">assertTrue</span><span class="op">(</span>col1<span class="op">.</span><span class="fu">get</span><span class="op">(</span><span class="dv">5</span><span class="op">).</span><span class="fu">isNa</span><span class="op">());</span></span>
<span id="cb3-10"><a href="#cb3-10" tabindex="-1"></a>        <span class="fu">assertFalse</span><span class="op">(</span>col1<span class="op">.</span><span class="fu">get</span><span class="op">(</span><span class="dv">6</span><span class="op">).</span><span class="fu">isNa</span><span class="op">());</span></span>
<span id="cb3-11"><a href="#cb3-11" tabindex="-1"></a>        </span>
<span id="cb3-12"><a href="#cb3-12" tabindex="-1"></a>        <span class="fu">assertTrue</span><span class="op">(!</span>col1<span class="op">.</span><span class="fu">get</span><span class="op">(</span><span class="dv">4</span><span class="op">).</span><span class="fu">opt</span><span class="op">().</span><span class="fu">isPresent</span><span class="op">());</span></span>
<span id="cb3-13"><a href="#cb3-13" tabindex="-1"></a>        </span>
<span id="cb3-14"><a href="#cb3-14" tabindex="-1"></a>        <span class="co">// Alternatively RConverter has a set of collectors for Streams of convertible types.</span></span>
<span id="cb3-15"><a href="#cb3-15" tabindex="-1"></a>        RIntegerVector col2 <span class="op">=</span> Stream<span class="op">.</span><span class="fu">of</span><span class="op">(</span>tmp<span class="op">).</span><span class="fu">collect</span><span class="op">(</span><span class="fu">integerCollector</span><span class="op">());</span></span>
<span id="cb3-16"><a href="#cb3-16" tabindex="-1"></a>        <span class="fu">assertTrue</span><span class="op">(</span>col1<span class="op">.</span><span class="fu">equals</span><span class="op">(</span>col0<span class="op">));</span></span>
<span id="cb3-17"><a href="#cb3-17" tabindex="-1"></a>        <span class="fu">assertTrue</span><span class="op">(</span>col1<span class="op">.</span><span class="fu">equals</span><span class="op">(</span>col2<span class="op">));</span></span>
<span id="cb3-18"><a href="#cb3-18" tabindex="-1"></a>        </span>
<span id="cb3-19"><a href="#cb3-19" tabindex="-1"></a>        <span class="co">// Conversion using a CollectionConverter to convert arbitrary collection types</span></span>
<span id="cb3-20"><a href="#cb3-20" tabindex="-1"></a>        RIntegerVector col3 <span class="op">=</span> <span class="fu">using</span><span class="op">(</span><span class="fu">integerCollector</span><span class="op">()).</span><span class="fu">convert</span><span class="op">(</span>tmp<span class="op">);</span></span>
<span id="cb3-21"><a href="#cb3-21" tabindex="-1"></a>        RIntegerVector col4 <span class="op">=</span> <span class="fu">using</span><span class="op">(</span><span class="fu">integerCollector</span><span class="op">()).</span><span class="fu">convert</span><span class="op">(</span><span class="bu">Arrays</span><span class="op">.</span><span class="fu">asList</span><span class="op">(</span>tmp<span class="op">));</span></span>
<span id="cb3-22"><a href="#cb3-22" tabindex="-1"></a>        RIntegerVector col5 <span class="op">=</span> <span class="fu">using</span><span class="op">(</span><span class="fu">integerCollector</span><span class="op">()).</span><span class="fu">convert</span><span class="op">(</span><span class="bu">Arrays</span><span class="op">.</span><span class="fu">asList</span><span class="op">(</span>tmp<span class="op">).</span><span class="fu">iterator</span><span class="op">());</span></span>
<span id="cb3-23"><a href="#cb3-23" tabindex="-1"></a>        RIntegerVector col6 <span class="op">=</span> <span class="fu">using</span><span class="op">(</span><span class="fu">integerCollector</span><span class="op">()).</span><span class="fu">convert</span><span class="op">(</span>Stream<span class="op">.</span><span class="fu">of</span><span class="op">(</span>tmp<span class="op">));</span></span>
<span id="cb3-24"><a href="#cb3-24" tabindex="-1"></a>        <span class="co">// These should all be the same     </span></span>
<span id="cb3-25"><a href="#cb3-25" tabindex="-1"></a>        <span class="fu">assertTrue</span><span class="op">(</span>col1<span class="op">.</span><span class="fu">equals</span><span class="op">(</span>col3<span class="op">));</span></span>
<span id="cb3-26"><a href="#cb3-26" tabindex="-1"></a>        <span class="fu">assertTrue</span><span class="op">(</span>col1<span class="op">.</span><span class="fu">equals</span><span class="op">(</span>col4<span class="op">));</span></span>
<span id="cb3-27"><a href="#cb3-27" tabindex="-1"></a>        <span class="fu">assertTrue</span><span class="op">(</span>col1<span class="op">.</span><span class="fu">equals</span><span class="op">(</span>col5<span class="op">));</span></span>
<span id="cb3-28"><a href="#cb3-28" tabindex="-1"></a>        <span class="fu">assertTrue</span><span class="op">(</span>col1<span class="op">.</span><span class="fu">equals</span><span class="op">(</span>col6<span class="op">));</span></span>
<span id="cb3-29"><a href="#cb3-29" tabindex="-1"></a>                </span>
<span id="cb3-30"><a href="#cb3-30" tabindex="-1"></a>        <span class="co">// But Converting collectors can also handle singleton conversions</span></span>
<span id="cb3-31"><a href="#cb3-31" tabindex="-1"></a>        RIntegerVector i1 <span class="op">=</span> <span class="fu">using</span><span class="op">(</span><span class="fu">integerCollector</span><span class="op">()).</span><span class="fu">convert</span><span class="op">(</span>tmp<span class="op">[</span><span class="dv">0</span><span class="op">]);</span></span>
<span id="cb3-32"><a href="#cb3-32" tabindex="-1"></a>        <span class="fu">assertTrue</span><span class="op">(</span>i1<span class="op">.</span><span class="fu">get</span><span class="op">(</span><span class="dv">0</span><span class="op">)</span> <span class="kw">instanceof</span> RInteger<span class="op">);</span></span>
<span id="cb3-33"><a href="#cb3-33" tabindex="-1"></a>        <span class="fu">assertTrue</span><span class="op">(</span>col1<span class="op">.</span><span class="fu">get</span><span class="op">(</span><span class="dv">0</span><span class="op">).</span><span class="fu">equals</span><span class="op">(</span>i1<span class="op">.</span><span class="fu">get</span><span class="op">(</span><span class="dv">0</span><span class="op">)));</span></span>
<span id="cb3-34"><a href="#cb3-34" tabindex="-1"></a>                        </span>
<span id="cb3-35"><a href="#cb3-35" tabindex="-1"></a>        <span class="co">// Primitive arrays are slightly less flexible but RConverter can process them</span></span>
<span id="cb3-36"><a href="#cb3-36" tabindex="-1"></a>        <span class="co">// nulls are not allowed but the "equivalent" to NA is Integer.MIN_VALUE = RInteger.NA_INT</span></span>
<span id="cb3-37"><a href="#cb3-37" tabindex="-1"></a>        <span class="co">// If they are converted to a boxed form by an IntStream they can be collected as above</span></span>
<span id="cb3-38"><a href="#cb3-38" tabindex="-1"></a>        <span class="dt">int</span><span class="op">[]</span> tmp2 <span class="op">=</span> <span class="op">{</span><span class="dv">1</span><span class="op">,</span><span class="dv">3</span><span class="op">,</span><span class="dv">5</span><span class="op">,</span><span class="dv">7</span><span class="op">,</span> <span class="bu">Integer</span><span class="op">.</span><span class="fu">MIN_VALUE</span><span class="op">,</span> <span class="bu">Integer</span><span class="op">.</span><span class="fu">MIN_VALUE</span><span class="op">,</span> <span class="bu">Integer</span><span class="op">.</span><span class="fu">MIN_VALUE</span><span class="op">+</span><span class="dv">1</span><span class="op">,</span> <span class="dv">0</span><span class="op">};</span></span>
<span id="cb3-39"><a href="#cb3-39" tabindex="-1"></a>        RIntegerVector col7 <span class="op">=</span> <span class="fu">convert</span><span class="op">(</span>tmp2<span class="op">);</span></span>
<span id="cb3-40"><a href="#cb3-40" tabindex="-1"></a>        RIntegerVector col8 <span class="op">=</span> IntStream<span class="op">.</span><span class="fu">of</span><span class="op">(</span>tmp2<span class="op">).</span><span class="fu">boxed</span><span class="op">().</span><span class="fu">collect</span><span class="op">(</span><span class="fu">integerCollector</span><span class="op">());</span></span>
<span id="cb3-41"><a href="#cb3-41" tabindex="-1"></a>        <span class="fu">assertTrue</span><span class="op">(</span>col1<span class="op">.</span><span class="fu">equals</span><span class="op">(</span>col7<span class="op">));</span></span>
<span id="cb3-42"><a href="#cb3-42" tabindex="-1"></a>        <span class="fu">assertTrue</span><span class="op">(</span>col1<span class="op">.</span><span class="fu">equals</span><span class="op">(</span>col8<span class="op">));</span></span>
<span id="cb3-43"><a href="#cb3-43" tabindex="-1"></a>        </span></code></pre></div>
<p>Other <code>RVector</code> examples show using the
<code>RConverter</code> collector methods for different data types:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a>        </span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a>        <span class="co">//Dates - difficulty is getting a stream of maybe null dates</span></span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a>        <span class="co">//Collect streams of other data types:</span></span>
<span id="cb4-4"><a href="#cb4-4" tabindex="-1"></a>        RDateVector rdv <span class="op">=</span> Stream</span>
<span id="cb4-5"><a href="#cb4-5" tabindex="-1"></a>                <span class="op">.</span><span class="fu">of</span><span class="op">(</span><span class="st">"2020-03-01"</span><span class="op">,</span><span class="st">"2020-03-02"</span><span class="op">,</span><span class="st">"2020-03-03"</span><span class="op">,</span><span class="kw">null</span><span class="op">,</span><span class="st">"2020-03-05"</span><span class="op">)</span></span>
<span id="cb4-6"><a href="#cb4-6" tabindex="-1"></a>                <span class="op">.</span><span class="fu">collect</span><span class="op">(</span><span class="fu">dateFromStringCollector</span><span class="op">());</span></span>
<span id="cb4-7"><a href="#cb4-7" tabindex="-1"></a>        RLogicalVector rlv1 <span class="op">=</span> rdv<span class="op">.</span><span class="fu">stream</span><span class="op">().</span><span class="fu">map</span><span class="op">(</span>d <span class="op">-&gt;</span> d<span class="op">.</span><span class="fu">isNa</span><span class="op">()).</span><span class="fu">collect</span><span class="op">(</span><span class="fu">booleanCollector</span><span class="op">());</span></span>
<span id="cb4-8"><a href="#cb4-8" tabindex="-1"></a>        <span class="co">//or use RConverter.convert on arrays</span></span>
<span id="cb4-9"><a href="#cb4-9" tabindex="-1"></a>        <span class="dt">boolean</span><span class="op">[]</span> bools <span class="op">=</span> <span class="op">{</span><span class="kw">false</span><span class="op">,</span><span class="kw">false</span><span class="op">,</span><span class="kw">false</span><span class="op">,</span><span class="kw">true</span><span class="op">,</span><span class="kw">false</span><span class="op">};</span></span>
<span id="cb4-10"><a href="#cb4-10" tabindex="-1"></a>        <span class="dt">boolean</span><span class="op">[]</span> bools2 <span class="op">=</span> <span class="op">{</span><span class="kw">false</span><span class="op">,</span><span class="kw">false</span><span class="op">,</span><span class="kw">false</span><span class="op">,</span><span class="kw">true</span><span class="op">,</span><span class="kw">true</span><span class="op">};</span></span>
<span id="cb4-11"><a href="#cb4-11" tabindex="-1"></a>        <span class="fu">assertTrue</span><span class="op">(</span>rlv1<span class="op">.</span><span class="fu">equals</span><span class="op">(</span><span class="fu">convert</span><span class="op">(</span>bools<span class="op">)));</span></span>
<span id="cb4-12"><a href="#cb4-12" tabindex="-1"></a>        <span class="fu">assertTrue</span><span class="op">(!</span>rlv1<span class="op">.</span><span class="fu">equals</span><span class="op">(</span><span class="fu">convert</span><span class="op">(</span>bools2<span class="op">)));</span></span>
<span id="cb4-13"><a href="#cb4-13" tabindex="-1"></a>        </span></code></pre></div>
</div>
<div class="section level2">
<h2 id="rdataframe-binding-to-pojos">RDataframe binding to POJOs<a class="anchor" aria-label="anchor" href="#rdataframe-binding-to-pojos"></a>
</h2>
<p>Whe inputting data it is possible to convert dataframe input by
defining a interface using <code>@RName</code> annotations where the
name matched the column names. The type of the data must also be given
as the columns in an <code>RDataframe</code> class are loosely
typed.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="kw">import</span> <span class="im">uk</span><span class="op">.</span><span class="im">co</span><span class="op">.</span><span class="im">terminological</span><span class="op">.</span><span class="im">rjava</span><span class="op">.</span><span class="im">RName</span><span class="op">;</span></span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a><span class="kw">import</span> <span class="im">uk</span><span class="op">.</span><span class="im">co</span><span class="op">.</span><span class="im">terminological</span><span class="op">.</span><span class="im">rjava</span><span class="op">.</span><span class="im">types</span><span class="op">.</span><span class="im">RFactor</span><span class="op">;</span></span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a><span class="kw">import</span> <span class="im">uk</span><span class="op">.</span><span class="im">co</span><span class="op">.</span><span class="im">terminological</span><span class="op">.</span><span class="im">rjava</span><span class="op">.</span><span class="im">types</span><span class="op">.</span><span class="im">RInteger</span><span class="op">;</span></span>
<span id="cb5-4"><a href="#cb5-4" tabindex="-1"></a><span class="kw">import</span> <span class="im">uk</span><span class="op">.</span><span class="im">co</span><span class="op">.</span><span class="im">terminological</span><span class="op">.</span><span class="im">rjava</span><span class="op">.</span><span class="im">types</span><span class="op">.</span><span class="im">RNumeric</span><span class="op">;</span></span>
<span id="cb5-5"><a href="#cb5-5" tabindex="-1"></a></span>
<span id="cb5-6"><a href="#cb5-6" tabindex="-1"></a><span class="kw">public</span> <span class="kw">interface</span> DiamondPOJO <span class="op">{</span></span>
<span id="cb5-7"><a href="#cb5-7" tabindex="-1"></a></span>
<span id="cb5-8"><a href="#cb5-8" tabindex="-1"></a>    <span class="at">@RName</span><span class="op">(</span><span class="st">"carat"</span><span class="op">)</span> <span class="kw">public</span> RNumeric <span class="fu">getCarat</span><span class="op">();</span></span>
<span id="cb5-9"><a href="#cb5-9" tabindex="-1"></a>    <span class="at">@RName</span><span class="op">(</span><span class="st">"depth"</span><span class="op">)</span> <span class="kw">public</span> RNumeric <span class="fu">getDepth</span><span class="op">();</span></span>
<span id="cb5-10"><a href="#cb5-10" tabindex="-1"></a>    <span class="at">@RName</span><span class="op">(</span><span class="st">"table"</span><span class="op">)</span> <span class="kw">public</span> RNumeric <span class="fu">getTable</span><span class="op">();</span></span>
<span id="cb5-11"><a href="#cb5-11" tabindex="-1"></a>    <span class="at">@RName</span><span class="op">(</span><span class="st">"price"</span><span class="op">)</span> <span class="kw">public</span> RInteger <span class="fu">getPrice</span><span class="op">();</span></span>
<span id="cb5-12"><a href="#cb5-12" tabindex="-1"></a>    <span class="at">@RName</span><span class="op">(</span><span class="st">"clarity"</span><span class="op">)</span> <span class="kw">public</span> RFactor <span class="fu">getClarity</span><span class="op">();</span></span>
<span id="cb5-13"><a href="#cb5-13" tabindex="-1"></a>    </span>
<span id="cb5-14"><a href="#cb5-14" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>Once an interface is defined binding that to a dataframe and
streaming the result gives a :</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a>            Stream<span class="op">&lt;</span>DiamondPOJO<span class="op">&gt;</span> bound <span class="op">=</span> FeatureTest</span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a>                <span class="op">.</span><span class="fu">diamonds</span><span class="op">()</span></span>
<span id="cb6-3"><a href="#cb6-3" tabindex="-1"></a>                <span class="op">.</span><span class="fu">attach</span><span class="op">(</span>DiamondPOJO<span class="op">.</span><span class="fu">class</span><span class="op">)</span></span>
<span id="cb6-4"><a href="#cb6-4" tabindex="-1"></a>                <span class="op">.</span><span class="fu">streamCoerce</span><span class="op">();</span></span>
<span id="cb6-5"><a href="#cb6-5" tabindex="-1"></a>            </span>
<span id="cb6-6"><a href="#cb6-6" tabindex="-1"></a>            <span class="dt">double</span> averageDepth <span class="op">=</span> bound<span class="op">.</span><span class="fu">mapToDouble</span><span class="op">(</span>d <span class="op">-&gt;</span> d<span class="op">.</span><span class="fu">getDepth</span><span class="op">().</span><span class="fu">get</span><span class="op">()).</span><span class="fu">average</span><span class="op">().</span><span class="fu">getAsDouble</span><span class="op">();</span></span>
<span id="cb6-7"><a href="#cb6-7" tabindex="-1"></a>            <span class="bu">System</span><span class="op">.</span><span class="fu">out</span><span class="op">.</span><span class="fu">print</span><span class="op">(</span><span class="st">"average depth: "</span><span class="op">+</span>averageDepth<span class="op">);</span></span>
<span id="cb6-8"><a href="#cb6-8" tabindex="-1"></a>            </span>
<span id="cb6-9"><a href="#cb6-9" tabindex="-1"></a>            <span class="co">// mean(diamonds$depth)</span></span>
<span id="cb6-10"><a href="#cb6-10" tabindex="-1"></a>            <span class="co">// [1] 61.7494</span></span></code></pre></div>
<p>In another example you can see the <code>@RName</code> annotation is
only needed if the name does not match exactly (which if you are
following POJO conventions it will not).</p>
<p>The interface can define default methods which can be used to
transform the data.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a>    <span class="co">// N.B. interface specification must be public</span></span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a>    <span class="kw">public</span> <span class="dt">static</span> <span class="kw">interface</span> Diamonds <span class="op">{</span></span>
<span id="cb7-3"><a href="#cb7-3" tabindex="-1"></a>        <span class="at">@RName</span><span class="op">(</span><span class="st">"carat"</span><span class="op">)</span> <span class="kw">public</span> RNumeric <span class="fu">getCarats</span><span class="op">();</span></span>
<span id="cb7-4"><a href="#cb7-4" tabindex="-1"></a>        <span class="at">@RName</span><span class="op">(</span><span class="st">"cut"</span><span class="op">)</span> <span class="kw">public</span> RFactor <span class="fu">getCuts</span><span class="op">();</span></span>
<span id="cb7-5"><a href="#cb7-5" tabindex="-1"></a>        <span class="kw">public</span> RInteger <span class="fu">price</span><span class="op">();</span> <span class="co">//doesn't have to be named if </span></span>
<span id="cb7-6"><a href="#cb7-6" tabindex="-1"></a>        <span class="kw">public</span> <span class="kw">default</span> <span class="dt">void</span> <span class="fu">print</span><span class="op">()</span> <span class="op">{</span></span>
<span id="cb7-7"><a href="#cb7-7" tabindex="-1"></a>            <span class="bu">System</span><span class="op">.</span><span class="fu">out</span><span class="op">.</span><span class="fu">println</span><span class="op">(</span><span class="st">"price: "</span><span class="op">+</span><span class="kw">this</span><span class="op">.</span><span class="fu">price</span><span class="op">()+</span><span class="st">"; carats: "</span><span class="op">+</span><span class="kw">this</span><span class="op">.</span><span class="fu">getCarats</span><span class="op">()</span> <span class="op">+</span> <span class="st">"; cut: "</span><span class="op">+</span><span class="kw">this</span><span class="op">.</span><span class="fu">getCuts</span><span class="op">());</span></span>
<span id="cb7-8"><a href="#cb7-8" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb7-9"><a href="#cb7-9" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb7-10"><a href="#cb7-10" tabindex="-1"></a>    </span>
<span id="cb7-11"><a href="#cb7-11" tabindex="-1"></a>    <span class="at">@Test</span></span>
<span id="cb7-12"><a href="#cb7-12" tabindex="-1"></a>    <span class="dt">final</span> <span class="dt">void</span> <span class="fu">testDataframeCoercion</span><span class="op">()</span> <span class="kw">throws</span> <span class="bu">IOException</span><span class="op">,</span> UnconvertableTypeException <span class="op">{</span></span>
<span id="cb7-13"><a href="#cb7-13" tabindex="-1"></a>        RDataframe dia <span class="op">=</span> <span class="fu">getDiamonds</span><span class="op">();</span></span>
<span id="cb7-14"><a href="#cb7-14" tabindex="-1"></a>        <span class="co">//Test object binding and default interface methods:</span></span>
<span id="cb7-15"><a href="#cb7-15" tabindex="-1"></a>        dia<span class="op">.</span><span class="fu">stream</span><span class="op">(</span>Diamonds<span class="op">.</span><span class="fu">class</span><span class="op">).</span><span class="fu">limit</span><span class="op">(</span><span class="dv">10</span><span class="op">).</span><span class="fu">forEach</span><span class="op">(</span>Diamonds<span class="op">::</span>print<span class="op">);</span></span>
<span id="cb7-16"><a href="#cb7-16" tabindex="-1"></a>        </span>
<span id="cb7-17"><a href="#cb7-17" tabindex="-1"></a>        <span class="bu">System</span><span class="op">.</span><span class="fu">out</span><span class="op">.</span><span class="fu">println</span><span class="op">(</span><span class="st">""</span><span class="op">+</span>dia<span class="op">.</span><span class="fu">pull</span><span class="op">(</span><span class="st">"price"</span><span class="op">,</span>RIntegerVector<span class="op">.</span><span class="fu">class</span><span class="op">).</span><span class="fu">get</span><span class="op">().</span><span class="fu">collect</span><span class="op">(</span>Collectors<span class="op">.</span><span class="fu">averagingDouble</span><span class="op">(</span>x <span class="op">-&gt;</span> <span class="op">(</span><span class="dt">double</span><span class="op">)</span> x<span class="op">)));</span></span>
<span id="cb7-18"><a href="#cb7-18" tabindex="-1"></a>        </span>
<span id="cb7-19"><a href="#cb7-19" tabindex="-1"></a>        dia<span class="op">.</span><span class="fu">attach</span><span class="op">(</span>Diamonds<span class="op">.</span><span class="fu">class</span><span class="op">).</span><span class="fu">getCoercedRow</span><span class="op">(</span><span class="dv">100</span><span class="op">).</span><span class="fu">getCuts</span><span class="op">().</span><span class="fu">get</span><span class="op">();</span></span>
<span id="cb7-20"><a href="#cb7-20" tabindex="-1"></a>        dia<span class="op">.</span><span class="fu">attach</span><span class="op">(</span>Diamonds<span class="op">.</span><span class="fu">class</span><span class="op">).</span><span class="fu">getRow</span><span class="op">(</span><span class="dv">100</span><span class="op">).</span><span class="fu">lag</span><span class="op">().</span><span class="fu">coerce</span><span class="op">().</span><span class="fu">getCuts</span><span class="op">().</span><span class="fu">get</span><span class="op">();</span></span>
<span id="cb7-21"><a href="#cb7-21" tabindex="-1"></a>    <span class="op">}</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="streaming-pojos-to-rdataframes">Streaming POJOs to RDataframes<a class="anchor" aria-label="anchor" href="#streaming-pojos-to-rdataframes"></a>
</h2>
<p>A stream of Java objects can be collected into a R data frame using a
dataframe collector. This defines the mappings from object to value
associated with each column name. The result is an
<code>RDataframe</code> that can be passed back to R as the result of a
Java method.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a>        <span class="co">//Use a stream + dataframe collector to generate data frame:</span></span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a>        <span class="bu">Arrays</span><span class="op">.</span><span class="fu">asList</span><span class="op">(</span><span class="st">"Hello"</span><span class="op">,</span><span class="st">"World"</span><span class="op">,</span><span class="st">"Stream"</span><span class="op">,</span><span class="st">"Support"</span><span class="op">,</span><span class="st">"in"</span><span class="op">,</span><span class="st">"Java"</span><span class="op">)</span></span>
<span id="cb8-3"><a href="#cb8-3" tabindex="-1"></a>        <span class="op">.</span><span class="fu">stream</span><span class="op">()</span></span>
<span id="cb8-4"><a href="#cb8-4" tabindex="-1"></a>        <span class="op">.</span><span class="fu">collect</span><span class="op">(</span><span class="fu">dataframeCollector</span><span class="op">(</span></span>
<span id="cb8-5"><a href="#cb8-5" tabindex="-1"></a>            <span class="fu">mapping</span><span class="op">(</span><span class="st">"original"</span><span class="op">,</span> s<span class="op">-&gt;</span> s<span class="op">),</span></span>
<span id="cb8-6"><a href="#cb8-6" tabindex="-1"></a>            <span class="fu">mapping</span><span class="op">(</span><span class="st">"lowercase"</span><span class="op">,</span> s<span class="op">-&gt;</span> s<span class="op">.</span><span class="fu">toLowerCase</span><span class="op">()),</span></span>
<span id="cb8-7"><a href="#cb8-7" tabindex="-1"></a>            <span class="fu">mapping</span><span class="op">(</span><span class="st">"uppercase"</span><span class="op">,</span> s<span class="op">-&gt;</span> s<span class="op">.</span><span class="fu">toUpperCase</span><span class="op">()),</span></span>
<span id="cb8-8"><a href="#cb8-8" tabindex="-1"></a>            <span class="fu">mapping</span><span class="op">(</span><span class="st">"subst"</span><span class="op">,</span> s<span class="op">-&gt;</span> s<span class="op">.</span><span class="fu">substring</span><span class="op">(</span><span class="dv">0</span><span class="op">,</span><span class="bu">Math</span><span class="op">.</span><span class="fu">min</span><span class="op">(</span><span class="dv">3</span><span class="op">,</span>s<span class="op">.</span><span class="fu">length</span><span class="op">()))),</span></span>
<span id="cb8-9"><a href="#cb8-9" tabindex="-1"></a>            <span class="fu">mapping</span><span class="op">(</span><span class="st">"length"</span><span class="op">,</span> s<span class="op">-&gt;</span> s<span class="op">.</span><span class="fu">length</span><span class="op">())</span></span>
<span id="cb8-10"><a href="#cb8-10" tabindex="-1"></a>        <span class="op">));</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="lists-and-named-lists">Lists and named lists<a class="anchor" aria-label="anchor" href="#lists-and-named-lists"></a>
</h2>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Rob Challen, terminological, Rob Challen.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
